<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no">
    <title>Mega Kreatif - Lupa Password</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="auth-style.css">
    <style>
        .step-container {
            display: none;
        }

        .step-container.active {
            display: block;
            animation: slideUp 0.4s ease;
        }

        .method-card {
            background: rgba(255, 255, 255, 0.03);
            border: 0.06rem solid var(--glass-border);
            border-radius: 1rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .method-card:hover,
        .method-card.selected {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--primary);
            box-shadow: var(--glow);
        }

        .method-icon {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.6rem;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.125rem;
            color: var(--text-main);
        }

        .method-info h3 {
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 0.125rem;
        }

        .method-info p {
            font-size: 0.7rem;
            color: var(--text-dim);
        }

        .otp-container {
            display: flex;
            gap: 0.6rem;
            justify-content: center;
            margin: 1.25rem 0;
        }

        .otp-input {
            width: 2.8rem;
            height: 2.8rem;
            border-radius: 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border: 0.06rem solid var(--glass-border);
            color: white;
            font-size: 1.125rem;
            font-weight: 700;
            text-align: center;
            outline: none;
        }

        .otp-input:focus {
            border-color: var(--primary);
            box-shadow: var(--glow);
        }

        .timer-text {
            text-align: center;
            font-size: 12px;
            color: var(--text-dim);
            margin-top: 10px;
        }

        .timer-text a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            pointer-events: none;
            opacity: 0.5;
        }

        .timer-text a.active {
            pointer-events: auto;
            opacity: 1;
        }

        .strength-meter {
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            margin-top: 8px;
            overflow: hidden;
            display: flex;
        }

        .strength-bar {
            height: 100%;
            width: 0;
            transition: width 0.3s, background-color 0.3s;
        }

        .strength-text {
            font-size: 10px;
            margin-top: 5px;
            text-align: right;
            color: var(--text-dim);
        }

        .success-icon {
            width: 4.5rem;
            height: 4.5rem;
            background: rgba(16, 185, 129, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: var(--success);
            margin: 0 auto 1.25rem;
            box-shadow: 0 0 2rem rgba(16, 185, 129, 0.3);
        }
    </style>
</head>

<body>

    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>

    <div id="toast-container" class="toast-container"></div>

    <div class="device-frame">
        <div class="screen-content">
            <!-- Step 1: Select Method -->
            <div id="step-1" class="step-container auth-card active">
                <div class="welcome-text">
                    <h2>Lupa Password?</h2>
                    <p>Pilih metode untuk mereset password Anda.</p>
                </div>

                <div class="method-card" onclick="selectMethod('email', this)">
                    <div class="method-icon"><i class="fas fa-envelope"></i></div>
                    <div class="method-info">
                        <h3>Via Email</h3>
                        <p>Kirim kode ke email terdaftar</p>
                    </div>
                </div>

                <div class="method-card" onclick="selectMethod('sms', this)">
                    <div class="method-icon"><i class="fas fa-sms"></i></div>
                    <div class="method-info">
                        <h3>Via SMS</h3>
                        <p>Kirim kode ke No. HP terdaftar</p>
                    </div>
                </div>

                <button class="btn-primary" onclick="goToStep(2)" disabled id="btn-step-1"
                    style="margin-top:10px">Lanjutkan</button>
                <a href="index.html" class="btn-secondary">Kembali ke Login</a>
            </div>

            <!-- Step 2: Input Details -->
            <div id="step-2" class="step-container auth-card">
                <div class="welcome-text">
                    <h2>Verifikasi Akun</h2>
                    <p id="step-2-desc">Masukkan detail akun Anda.</p>
                </div>

                <div class="input-group" id="contact-group">
                    <i id="input-icon" class="fas fa-envelope"></i>
                    <input type="text" id="contact-input" placeholder="Masukkan Email Anda">
                    <div id="step-2-error" class="error-msg"></div>
                </div>

                <button class="btn-primary" onclick="validateAndSendCode()">Kirim Kode</button>
                <button class="btn-secondary" onclick="goToStep(1)">Kembali</button>
            </div>

            <!-- Step 3: OTP Verification -->
            <div id="step-3" class="step-container auth-card">
                <div class="welcome-text">
                    <h2>Verifikasi Kode</h2>
                    <p>Kode telah dikirim ke <span id="sent-destination"
                            style="color: white; font-weight: 600;">...</span></p>
                </div>

                <div class="otp-container">
                    <input type="text" class="otp-input" maxlength="1" oninput="moveToNext(this, 1)">
                    <input type="text" class="otp-input" maxlength="1" oninput="moveToNext(this, 2)">
                    <input type="text" class="otp-input" maxlength="1" oninput="moveToNext(this, 3)">
                    <input type="text" class="otp-input" maxlength="1" oninput="moveToNext(this, 4)">
                </div>

                <button class="btn-primary" onclick="verifyOtp()">Verifikasi</button>

                <div class="timer-text">
                    Tidak menerima kode? <a href="#" id="resend-link" onclick="resendCode()">Kirim Ulang</a> <span
                        id="timer">(30s)</span>
                </div>
            </div>

            <!-- Step 4: New Password -->
            <div id="step-4" class="step-container auth-card">
                <div class="welcome-text">
                    <h2>Password Baru</h2>
                    <p>Buat password baru yang aman.</p>
                </div>

                <div class="input-group" id="p1-group">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="new-pass" placeholder="Password Baru" oninput="checkStrength()">
                </div>
                <!-- Strength Meter -->
                <div style="margin-bottom: 15px;">
                    <div class="strength-meter">
                        <div class="strength-bar" id="strength-bar"></div>
                    </div>
                    <div class="strength-text" id="strength-text"></div>
                </div>

                <div class="input-group" id="p2-group">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="confirm-pass" placeholder="Konfirmasi Password Baru">
                    <div id="pass-error" class="error-msg"></div>
                </div>

                <button class="btn-primary" onclick="savePassword()">Simpan Password</button>
            </div>

            <!-- Step 5: Success -->
            <div id="step-5" class="step-container auth-card" style="text-align: center;">
                <div class="success-icon">
                    <i class="fas fa-check"></i>
                </div>
                <div class="welcome-text">
                    <h2>Berhasil Diubah!</h2>
                    <p>Password Anda telah berhasil diperbarui.</p>
                </div>
                <a href="index.html" class="btn-primary">Masuk Sekarang</a>
            </div>
        </div>
    </div>

    <script src="auth-logic.js"></script>
    <script>
        let currentMethod = '';
        let timerInterval;

        function goToStep(stepNumber) {
            document.querySelectorAll('.step-container').forEach(el => el.classList.remove('active'));
            document.getElementById(`step-${stepNumber}`).classList.add('active');
        }

        function selectMethod(method, card) {
            currentMethod = method;
            document.querySelectorAll('.method-card').forEach(el => el.classList.remove('selected'));
            card.classList.add('selected');
            document.getElementById('btn-step-1').disabled = false;
        }

        // Setup Step 2
        document.getElementById('btn-step-1').addEventListener('click', () => {
            const input = document.getElementById('contact-input');
            const icon = document.getElementById('input-icon');
            const desc = document.getElementById('step-2-desc');

            if (currentMethod === 'email') {
                input.placeholder = "contoh@email.com";
                input.type = "email";
                icon.className = "fas fa-envelope";
                desc.textContent = "Masukkan alamat email yang terdaftar.";
            } else {
                input.placeholder = "0812xxxx";
                input.type = "tel";
                icon.className = "fas fa-phone";
                desc.textContent = "Masukkan nomor HP yang terdaftar.";
            }
            goToStep(2);
        });

        function validateAndSendCode() {
            const val = document.getElementById('contact-input').value;
            const errorEl = document.getElementById('step-2-error');
            const group = document.getElementById('contact-group');

            if (!val) {
                showError(group, errorEl, "Data tidak boleh kosong.");
                return;
            }

            if (currentMethod === 'email' && !val.includes('@')) {
                showError(group, errorEl, "Format email tidak valid.");
                return;
            }

            // Success simulation
            showError(group, errorEl, "");
            document.getElementById('sent-destination').textContent = val;
            startTimer();
            goToStep(3);
        }

        function moveToNext(field, index) {
            if (field.value.length >= 1) {
                const next = document.querySelectorAll('.otp-input')[index];
                if (next) next.focus();
            }
        }

        function startTimer() {
            let timeLeft = 30;
            const link = document.getElementById('resend-link');
            const display = document.getElementById('timer');
            link.classList.remove('active');
            display.style.display = 'inline';
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                display.textContent = `(${timeLeft}s)`;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    link.classList.add('active');
                    display.style.display = 'none';
                }
            }, 1000);
        }

        function resendCode() {
            document.querySelectorAll('.otp-input').forEach(i => i.value = '');
            startTimer();
            showToast("Kode baru telah dikirim!", "success");
        }

        function verifyOtp() {
            const inputs = document.querySelectorAll('.otp-input');
            let code = '';
            inputs.forEach(i => code += i.value);
            if (code.length < 4) {
                showToast("Masukkan 4 digit kode OTP.", "error");
                return;
            }
            goToStep(4);
        }

        function checkStrength() {
            const pass = document.getElementById('new-pass').value;
            const bar = document.getElementById('strength-bar');
            const text = document.getElementById('strength-text');
            let strength = 0;
            if (pass.length >= 8) strength++;
            if (/[A-Z]/.test(pass)) strength++;
            if (/[0-9]/.test(pass)) strength++;

            if (pass.length === 0) {
                bar.style.width = '0%'; text.textContent = ''; return;
            }

            if (strength === 1) {
                bar.style.width = '30%'; bar.style.backgroundColor = '#EF4444'; text.textContent = 'Lemah';
            } else if (strength === 2) {
                bar.style.width = '60%'; bar.style.backgroundColor = '#F59E0B'; text.textContent = 'Sedang';
            } else if (strength === 3) {
                bar.style.width = '100%'; bar.style.backgroundColor = '#10B981'; text.textContent = 'Kuat';
            }
        }

        function savePassword() {
            const p1 = document.getElementById('new-pass').value;
            const p2 = document.getElementById('confirm-pass').value;
            const error = document.getElementById('pass-error');
            const group = document.getElementById('p2-group');

            if (p1.length < 8) {
                showError(group, error, "Password minimal 8 karakter.");
                return;
            }
            if (p1 !== p2) {
                showError(group, error, "Konfirmasi password tidak cocok.");
                return;
            }
            showError(group, error, "");
            goToStep(5);
        }
    </script>
</body>

</html>